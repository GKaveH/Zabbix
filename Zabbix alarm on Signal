<h1>Signal Messenger for Zabbix 4.4.7</h1>
<h2>Overview</h2>
<p>how to Integrate Signal to Zabbix for notification. Signal-cli is a command line interface for Signal. for us It’s used to register a new signal account. </p>
<p>you can see more information on <a href='https://github.com/AsamK/signal-cli' target='_blank' class='url'>https://github.com/AsamK/signal-cli</a></p>
<h2>Step 1 – Prerequisites</h2>
<p>Log in to your system with root privilege account using shell access, to which you need to install Signal-Cli.</p>
<pre><code>ssh root@remote
</code></pre>
<p>On Ubuntu/Debian, you have to install below package </p>
<pre><code>root@zabbix:~# apt-get install libunixsocket-java
root@zabbix:~# apt-get install default-jre
</code></pre>
<h2>Step 2 – Installing Signal-Cli</h2>
<p>Get latest version from <a href='https://github.com/AsamK/signal-cli/releases' target='_blank' class='url'>https://github.com/AsamK/signal-cli/releases</a>, e.g. to opt directory.</p>
<pre><code>root@zabbix:~# wget -c https://github.com/AsamK/signal-cli/releases/download/v0.6.7/signal-cli-0.6.7.tar.gz
root@zabbix:~# tar xfv signal-cli-0.6.7.tar.gz -C /opt
root@zabbix:~# ln -sf /opt/signal-cli-0.6.7/bin/signal-cli /usr/local/bin/
</code></pre>
<h2>Step 3 – Give access to Zabbix user</h2>
<p>you must give accsess to Zabbix user so you can register your number with Zabbix user with sudoers. so we need edit sudoers file.</p>
<pre><code>root@zabbix:~# vim /etc/sudoers
</code></pre>
<p>add this to sudoers file.</p>
<pre><code>zabbix  ALL=(root) NOPASSWD: /opt/signal-cli-0.6.7/bin/signal-cli
</code></pre>
<h2>Step 4 – Register your number </h2>
<p>you can use Signal without a smartphone and  To be able to use Signal you have to register yourself with a phone number (doesn’t has to be a mobile number). So we execute this command.</p>
<pre><code>root@zabbix:~# sudo -u zabbix signal-cli -u Yournumber register
</code></pre>
<p><strong>Note :</strong> Your number should like this +Country Code Your number without space like +981111......</p>
<p>on the command line. If all goes well, there is no reply. Execution takes a few seconds. +981111...... After a few seconds, you will receive an SMS on your cell phone that contains the verification code like (123-456)</p>
<pre><code>Your Signal verification code: 123-456
</code></pre>
<p><strong>Note:</strong> You can register Signal using a land line number. In this case you can skip SMS verification process and jump directly to the voice call verification by adding the <code>--voice</code> switch at the end of above register command.</p>
<p>Then we must verify our registration with this command.</p>
<pre><code>root@zabbix:~# signal-cli -u Yournumber verify 123-456
</code></pre>
<h2>Step 5 – Send a first message from the command line </h2>
<p>We assume that the receiver of the message has the phone number +982222...... . Enter</p>
<pre><code>root@zabbix:~# sudo -u zabbix signal-cli -u +981111...... send -m &quot;Hello this is test message &quot; +982222......
</code></pre>
<p>on the command line. Again, no reply if all is fine. Within a few seconds, the Signal App on the cell phone +982222...... will receive the message.</p>
<h2>Step 6 – Create Signal script for Sending message automatically </h2>
<p>I must say this script was wrote by one of my best Friend Pejman Moghadam.</p>
<pre><code>#!/bin/bash
PATH=&quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;

sanitize() {
        echo &quot;$1&quot; | sed -e &#39;s,&amp;,#,g&#39;
}

# This is for shamsi date with Jcal if you can replace jdate with date 
DATE_EXEC=&quot;$(+%Y.%m.%d % on %T&quot;)&quot;

A=$(sanitize &quot;$2&quot;)
B=$(sanitize &quot;$3&quot;)
C=$(sanitize &quot;$1&quot;)

TEXT=&quot;$A
$B
Sent: $DATE_EXEC&quot;

echo &quot;$TEXT&quot; | grep -q &#39;Zabbix agent was unreachable&#39;
if [ &quot;$?&quot; == &quot;0&quot; ]; then
        echo &quot;MAIN($DATE_EXEC):$C &#39;Zabbix agent was unreachable&#39; Bypass&quot; &gt;&gt; /tmp/signal.log
        exit
fi

echo &quot;$TEXT&quot; | /usr/local/bin/signal-cli -u YourNumber send $C

echo &quot;MAIN:$C $TEXT&quot; &gt;&gt; /tmp/signal.log

</code></pre>
<p> <strong>Note :</strong> Remember to Replace your registration number with &quot;YourNumber&quot;</p>
<p>Then we must give our script permission to be executable with below command</p>
<pre><code>root@zabbix:~# chmod +x signal.sh
</code></pre>
<p><strong>Note</strong> : Move your script to Alert Scripts Path in your Zabbix_server.conf by default this path is </p>
<pre><code>AlertScriptsPath=/usr/lib/zabbix/alertscripts
</code></pre>
<h2>Step 7 – Create media type in Zabbix frontend</h2>
<p>In your frontend and  go to [Administration] tab and then click on [Media types] select [Create media type], and fill it for example like this</p>
<p><strong>Name :</strong> Signal</p>
<p><strong>Type :</strong> Script</p>
<p><strong>Script name :</strong>  signal.sh</p>
<p><strong>Script parameters :</strong></p>
<p>{ALERT.SENDTO}</p>
<p>{ALERT.SUBJECT}</p>
<p>{ALERT.MESSAGE}</p>
<h2>Step 8 – Create Action in Zabbix frontend</h2>
<p>In your frontend and  go to [Configuratin] tab and then click on [Action] select [Create action], and fill it for example like this.</p>
<ul>
<li><h6>in Conditions Filed you should add you desirable Condition</h6>
</li>

</ul>
<p><strong>Name :</strong> Signale Report Problems</p>
<p>in Conditions Filed you should add you desirable Condition</p>
<ul>
<li><h6>Then in Operations Tab do as below </h6>
</li>

</ul>
<p><strong>Default subject :</strong></p>
<p>{EVENT.STATUS}</p>
<p><strong>Default message :</strong></p>
<p>Host : {HOST.NAME}
Event: {EVENT.NAME}
Severity : {EVENT.SEVERITY}
Value : {EVENT.VALUE} 
Acknowledge: {EVENT.ACK.STATUS} 
Fired : {EVENT.DATE} on {EVENT.TIME}</p>
<p><strong>Note :</strong> In Send to User Filed Please select your User&#39;s for getting alarm via signal app.</p>
<ul>
<li><h6>also in Recovery operations Tab do as below </h6>
</li>

</ul>
<p><strong>Default subject :</strong></p>
<p>{EVENT.STATUS}</p>
<p><strong>Default message :</strong></p>
<p>Host : {HOST.NAME}
Event: {EVENT.NAME}
Severity : {EVENT.SEVERITY}
Value : {EVENT.VALUE} 
Acknowledge: {EVENT.ACK.STATUS} 
Fired : {EVENT.DATE} on {EVENT.TIME}</p>
<p>and at the end click on Update button and your done.</p>
